<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <link rel="icon" type="image/png" sizes="32x32" href="vcf.png">
  <title>G√©n√©rateur de VCF</title>

  <!-- Firebase App (obligatoire) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-app-compat.js"></script>

  <!-- Firebase Database (pour enregistrer les contacts) -->
  <script src="https://www.gstatic.com/firebasejs/10.11.1/firebase-database-compat.js"></script>

  <style>
    :root {
      --day-bg: #ffffff;
      --day-text: #000000;
      --night-bg: #1c1c1e;
      --night-text: #f5f5f5;
    }

    body {
      font-family: Arial, sans-serif;
      background-color: var(--day-bg);
      color: var(--day-text);
      transition: background-color 0.5s ease, color 0.5s ease;
      padding: 20px;
      text-align: center;
    }

    header {
      text-align: center;
      margin-bottom: 20px;
    }

    .container {
      background: rgba(255, 255, 255, 0.9);
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 10px 30px rgba(0, 0, 0, 0.2);
      width: 300px;
      text-align: center;
    }

    input, button {
      display: block;
      width: 100%;
      margin: 10px 0;
      padding: 12px;
      font-size: 16px;
      border: 1px solid #ccc;
      border-radius: 5px;
    }

    button {
      cursor: pointer;
      background-color: #19072A;
      color: white;
      border: none;
      transition: transform 0.3s ease, background-color 0.3s ease;
    }

    button:active {
      transform: scale(0.95);
      background-color: #128C7E;
    }

    /* Animation sur clic bouton t√©l√©charger */
    #download-btn.clicked {
      animation: pulse 0.6s ease;
    }

    @keyframes pulse {
      0% { transform: scale(1); background-color: #25D366; }
      50% { transform: scale(1.1); background-color: #128C7E; }
      100% { transform: scale(1); background-color: #25D366; }
    }

    /* Lien vers le channel */
    a {
      text-decoration: none;
      transition: color 0.3s ease;
    }

    a:hover {
      color: #128C7E;
    }

    /* Mode nuit */
    body.night {
      background-color: var(--night-bg);
      color: var(--night-text);
    }

    body.night .container {
      background-color: rgba(28, 28, 30, 0.95);
    }

    body.night input,
    body.night button {
      background-color: #2c2c2e;
      color: #ffffff;
      border: 1px solid #444;
    }

    /* Pop-up de confirmation */
    #confirmation-popup {
      display: none;
      position: fixed;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      background: rgba(0, 0, 0, 0.8);
      color: white;
      padding: 2rem;
      border-radius: 8px;
      box-shadow: 0 4px 12px rgba(0,0,0,0.3);
      text-align: center;
    }

    #confirmation-popup button {
      background-color: #00cfff;
      color: white;
      padding: 0.7rem;
      border: none;
      border-radius: 4px;
      cursor: pointer;
      margin-top: 1rem;
    }

    #confirmation-popup button:hover {
      background-color: #00b5e2;
    }

    .error {
      color: red;
      font-weight: bold;
    }

    .success {
      color: green;
      font-weight: bold;
    }

  </style>
</head>
<body>

  <header>
    <h2>Whatsapp views</h2>
    <p>Ce site vous permet d‚Äôobtenir un maximum de contact et de vues sur votre statut WhatsApp en quelques clics !</p>
  </header>

  <div class="container">
    <h1>Ajouter un contact</h1>
    <form id="vcfForm">
      <input type="text" id="fullName" placeholder="Nom complet" required>
      <input type="tel" id="phone" placeholder="+509XXXXXXXX" required>
      <small style="color: gray; font-size: 0.9em;">Entrez le num√©ro avec l‚Äôindicatif : ex. +50912345678</small>
      <button type="submit">Ajouter le contact</button>

      <div id="counter">
        Nombre de contacts enregistr√©s : <span id="contactCount">0</span>
      </div>
    </form>

    <div style="margin-top: 30px; text-align: center; padding: 15px; background-color: #f0f0f0; border-radius: 8px;">
      <p style="font-weight: bold; color: #25D366; text-decoration: none1;">
        <p>Il vous faut un mot de pass pour t√©l√©charger le fichier üìÅ appuyez sur rejoindre pour entrer dans le groupe.</p>
      </p>
    </div>
  </div>

  <h2> ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ‚òÜ</h2>

  <div id="message"></div>

  <div id="password-section">
    <input type="password" id="password" placeholder="un mot de pass pour le t√©l√©charger" required>
    <button id="downloadBtn" disabled>T√©l√©charger le fichier VCF</button>
  </div>

  <div id="group-link">
    <button id="joinGroupBtn">Rejoindre group vcf</button>
  </div>

  <!-- Pop-up de confirmation -->
  <div id="confirmation-popup">
    <p>Le fichier VCF a √©t√© t√©l√©charg√© avec succ√®s !</p>
    <button onclick="closePopup()">Fermer</button>
  </div>

  <script>
    const firebaseConfig = {
      apiKey: "AIzaSyA9jvwL_xzBBmn1kcbB0kLU-vbnMF0fs24",
      authDomain: "dyby-vcf-5f77c.firebaseapp.com",
      databaseURL: "https://dyby-vcf-5f77c-default-rtdb.europe-west1.firebasedatabase.app",
      projectId: "dyby-vcf-5f77c",
      storageBucket: "dyby-vcf-5f77c.appspot.com",
      messagingSenderId: "686902317644",
      appId: "1:686902317644:web:1f94c4415b70dd883d5ae9",
      measurementId: "G-R8F1KW2JEE"
    };

    firebase.initializeApp(firebaseConfig);
    const database = firebase.database();

    let contacts = []; // On ne stocke plus dans localStorage
    const phoneNumbers = new Set();

    // Charger les contacts depuis Firebase au d√©marrage
    database.ref('contacts').once('value', function(snapshot) {
      snapshot.forEach(childSnapshot => {
        const contact = childSnapshot.val();
        contacts.push(contact);
        phoneNumbers.add(contact.phone);
      });
      updateCounter(); // Mettre √† jour le compteur apr√®s avoir charg√©
    });

    document.getElementById('vcfForm').addEventListener('submit', function(e) {
      e.preventDefault();
      
      const fullName = document.getElementById('fullName').value.trim();
      const phone = document.getElementById('phone').value.trim();

      if (!fullName || !phone) {
        showMessage("Veuillez remplir tous les champs.", "error");
        return;
      }

      if (phoneNumbers.has(phone)) {
        showMessage("Ce num√©ro est d√©j√† enregistr√©.", "error");
        return;
      }

      // Ajouter dans Firebase
      const newContactRef = database.ref('contacts').push();
      newContactRef.set({
        fullName: fullName,
        phone: phone
      });

      // Ajouter localement pour √©viter les doublons pendant cette session
      contacts.push({ fullName, phone });
      phoneNumbers.add(phone);

      document.getElementById('fullName').value = '';
      document.getElementById('phone').value = '';

      showMessage("Votre num√©ro a √©t√© enregistr√© ‚úÖÔ∏è", "success");

      // R√©initialise le compteur √† z√©ro
      updateCounter(true);

      // Mettre √† jour tout de suite
      updateCounter();
    });

    // Fonction mise √† jour compteur
    function updateCounter(reset = false) {
      if (reset) {
        // Si on veut r√©initialiser le compteur, on met directement √† z√©ro
        document.getElementById('contactCount').textContent = "0";
      } else {
        // Sinon, on r√©cup√®re les contacts depuis Firebase et on met √† jour le compteur
        database.ref('contacts').once('value', function(snapshot) {
          const counter = document.getElementById('contactCount');
          counter.textContent = snapshot.numChildren();
        });
      }
    }

    // Fonction afficher message
    function showMessage(text, type) {
      const messageDiv = document.getElementById('message');
      messageDiv.textContent = text;
      messageDiv.className = type;
      
      // Red√©marrer animation
      void messageDiv.offsetWidth;
      messageDiv.classList.add(type);
    }

    // V√©rification du mot de passe
    document.getElementById('password').addEventListener('input', function() {
      const enteredPassword = document.getElementById('password').value.trim();
      const downloadBtn = document.getElementById('downloadBtn');
      const messageDiv = document.getElementById('message');
      
      if (enteredPassword === "30000000") {
        downloadBtn.disabled = false; // Active le bouton de t√©l√©chargement
        messageDiv.textContent = "Mot de passe correct. Vous pouvez t√©l√©charger le fichier.";
        messageDiv.className = "success";
      } else {
        downloadBtn.disabled = true; // D√©sactive le bouton de t√©l√©chargement
        messageDiv.textContent = "Mot de passe incorrect. Essayez encore.";
        messageDiv.className = "error";
      }
    });

    // T√©l√©charger fichier VCF
    document.getElementById('downloadBtn').addEventListener('click', async function() {
      let vcfData = '';

      const snapshot = await database.ref('contacts').once('value');
      snapshot.forEach(childSnapshot => {
        const contact = childSnapshot.val();
        vcfData += `
BEGIN:VCARD
VERSION:3.0
FN:${contact.fullName}
TEL;TYPE=cell:${contact.phone}
END:VCARD
        `.trim() + "\n";
      });

      const blob = new Blob([vcfData], { type: 'text/vcard' });
      const link = document.createElement('a');
      link.href = URL.createObjectURL(blob);
      link.download = 'contacts.vcf';
      link.click();
      
      showPopup();
    });

    // Affichage popup de confirmation
    function showPopup() {
      const popup = document.getElementById("confirmation-popup");
      popup.style.display = "block";
    }

    function closePopup() {
      const popup = document.getElementById("confirmation-popup");
      popup.style.display = "none";
    }
  </script>
</body>
  </html>
  
